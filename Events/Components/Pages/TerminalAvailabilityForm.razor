<MudForm @ref="form">
    <MudGrid gutterSize="3">
        <!-- Date Range Picker (full width on mobile) -->
        <MudItem xs="12">
            <MudDateRangePicker @bind-DateRange="_dateRange" 
                                Margin="Margin.Dense" 
                                ReadOnly="false" 
                                Clearable="true"
                                PlaceholderStart="Start Date" 
                                PlaceholderEnd="End Date" 
                                Label="Range" />
        </MudItem>

        <!-- Numeric Field for Total Terminals -->
        <MudItem xs="12" sm="6" md="4">
            <MudNumericField @bind-Value="Entity!.TotalTerminals"
                             Label="Total Available Terminal" 
                             Margin="Margin.Dense" />
        </MudItem>

        <!-- Data Grid, wrapped in a scrollable container for mobile -->
        @if (showGrid)
        {
            <MudItem xs="12">
                <MudPaper Class="pa-2" Style="overflow-x:auto;">
                    <MudDataGrid T="DailyTerminalAvailability" 
                                 Items="Entity!.DailyTerminalAvailability"
                                 ReadOnly="true" 
                                 Bordered="true" 
                                 Dense="true" 
                                 Striped="true" 
                                 Hover="true">
                        <Columns>
                            <PropertyColumn Property="x => x.Date" Title="Date" />
                            <PropertyColumn Property="x => x.TotalExpectedAssigned" Title="Total Expected Assigned" />
                            <PropertyColumn Property="x => x.TotalExpectedAvailable" Title="Total Expected Available" />
                            <PropertyColumn Property="x => x.TotalConfirmedAssigned" Title="Total Confirmed Assigned" />
                            <PropertyColumn Property="x => x.TotalConfirmedAvailable" Title="Total Confirmed Available" />
                        </Columns>
                        <PagerContent>
                            <MudDataGridPager T="DailyTerminalAvailability" />
                        </PagerContent>
                    </MudDataGrid>
                </MudPaper>
            </MudItem>
        }

        <!-- Action Buttons: vertical stack on mobile, horizontal on larger screens -->
        <MudItem xs="12" Class="d-flex flex-column flex-sm-row justify-end mt-4 gap-2">
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       OnClick="Query" 
                       FullWidth="true">
                Query
            </MudButton>
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Secondary" 
                       OnClick="Cancel" 
                       FullWidth="true">
                Cancel
            </MudButton>
        </MudItem>
    </MudGrid>
</MudForm>

@code {
    [Parameter]
    public TerminalAvailabilityParameters? Entity { get; set; }

    [Parameter]
    public EventCallback<TerminalAvailabilityParameters> OnQuery { get; set; }

    [Parameter]
    public EventCallback OnCancel { get; set; }

    private MudForm? form;
    private bool showGrid = false;
    private DateRange _dateRange = new DateRange(DateTime.Today, DateTime.Today.AddDays(1));

    private async Task Query()
    {
        await form!.Validate();
        if (form.IsValid)
        {
            showGrid = true;
            Entity!.StartDate = _dateRange.Start;
            Entity.EndDate = _dateRange.End;
            await OnQuery.InvokeAsync(Entity);
        }
    }

    private async Task Cancel()
    {
        showGrid = false;
        await OnCancel.InvokeAsync();
    }
}
